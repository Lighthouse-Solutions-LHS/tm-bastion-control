server {
    listen 80;
#    server_name staging.tellermitte.de tellermitte.de redesign.tellermitte.de relaunch.tellermitte.de tellermitte.com tm.lighthousesolution.de;
    server_name staging.tellermitte.de;
    root /var/www/wordpress/tellermitte;
    index index.php;

    # Basic Authentication for Staging Environment
#    auth_basic "Staging Area";
#    auth_basic_user_file /etc/nginx/.htpasswd;

    client_max_body_size 5G;

    # HSTS (Strict Transport Security)
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    # Referrer Policy
    add_header Referrer-Policy "no-referrer-when-downgrade";
    # Clickjacking Protection
    add_header X-Frame-Options "SAMEORIGIN";
    # MIME Sniffing Protection
    add_header X-Content-Type-Options "nosniff";

    # Worker Sources
    add_header Content-Security-Policy "worker-src blob: https://tellermitte.de  https://staging.tellermitte.de;";

    # Script Sources
    add_header Content-Security-Policy "script-src 'self' 'unsafe-inline' 'unsafe-eval' data: https://ajax.googleapis.com/ajax/libs/webfont/ https://in-automate.brevo.com https://sibautomation.com https://www.googletagmanager.com https://*.cleverreach.com/ https://*.trustedshops.com http://*.trustedshops.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://www.google-analytics.com https://www.googleadservices.com https://www.google.de https://googleads.g.doubleclick.net https://tagmanager.google.com https://ssl.google-analytics.com https://analytics.tiktok.com https://connect.facebook.net https://widgets.trustedshops.com https://www.facebook.com https://google-analytics.com https://static-eu.payments-amazon.com https://stats.g.doubleclick.net https://www.google.com https://www.youtube.com https://www.youtube.de https://www.youtube-nocookie.com https://i.ytimg.com https://heidelpay.hpcgw.net https://cdnjs.cloudflare.com https://cdn.datatables.net https://www.gstatic.com https://cdn.jsdelivr.net https://fast.wistia.com https://use.fontawesome.com https://leanbe.ai https://app.leanbe.ai https://beacon-v2.helpscout.net https://d3hb14vkzrxvla.cloudfront.net https://cloud-files.crsend.com https://rest.cleverreach.com https://yoast.com https://sibforms.com https://youtu.be https://js.stripe.com https://www.paypal.com https://www.paypalobjects.com https://c.paypal.com;";

    # Connect Sources
    add_header Content-Security-Policy "connect-src 'self' https://my.yoast.com https://*.google-analytics.com https://*.analytics.google.com https://sibautomation.com https://in-automate.brevo.com https://*.googletagmanager.com https://*.cleverreach.com/ https://*.trustedshops.com http://*.trustedshops.com https://*.etrusted.com http://*.etrusted.com https://*.trustbadge.com http://*.trustbadge.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://api.trustedshops.com https://*.g.doubleclick.net https://*.google.com https://*.google.de https://distillery.wistia.com https://api.wordpress.org https://cdn1.api.trustedshops.com https://static-eu.payments-amazon.com https://payments-eu.amazon.com https://stats.g.doubleclick.net https://www.google.com https://www.google.de https://www.youtube.com https://www.youtube.de https://widgets.trustedshops.com https://heidelpay.hpcgw.net https://cdnjs.cloudflare.com https://cdn.datatables.net https://cdn.jsdelivr.net https://use.fontawesome.com https://fast.wistia.com https://leanbe.ai https://app.leanbe.ai https://beaconapi.helpscout.net https://beacon-v2.helpscout.net https://d3hb14vkzrxvla.cloudfront.net https://analytics.tiktok.com https://cloud-files.crsend.com https://ip-detect.workers.aptoweb.com https://get.api-feiertage.de https://rest.cleverreach.com https://yoast.com www.youtube-nocookie.com https://www.sandbox.paypal.com https://www.paypal.com https://payments.amazon.de;";

    # Style Sources
    add_header Content-Security-Policy "style-src 'self' 'unsafe-inline' https://tagmanager.google.com https://fonts.googleapis.com https://sibautomation.com https://*.cleverreach.com/ https://in-automate.brevo.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://widgets.trustedshops.com https://tracking.tychesoftwares.com https://www.google-analytics.com https://static-eu.payments-amazon.com https://code.jquery.com https://heidelpay.hpcgw.net https://www.google.com https://cdnjs.cloudflare.com https://cdn.datatables.net https://cdn.jsdelivr.net https://use.fontawesome.com https://beacon-v2.helpscout.net https://yoast.com https://cloud-files.crsend.com https://sibforms.com https://www.google.de;";

    # Image Sources
    add_header Content-Security-Policy "img-src 'self' data: https://ssl.gstatic.com https://www.gstatic.com https://www.googletagmanager.com https://sibautomation.com/ https://*.cleverreach.com/ https://in-automate.brevo.com https://*.google-analytics.com https://*.googletagmanager.com https://*.trustedshops.com http://*.trustedshops.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://embed-ssl.wistia.com https://fast.wistia.com https://widgets.trustedshops.com https://secure.gravatar.com https://berocket.ams3.cdn.digitaloceanspaces.com https://woocommerce.com https://ps.w.org https://www.facebook.com https://www.google-analytics.com https://m.media-amazon.com https://cdn.shopify.com https://code.jquery.com https://www.google.com https://heidelpay.hpcgw.net https://cdnjs.cloudflare.com https://cdn.datatables.net https://cdn.jsdelivr.net https://use.fontawesome.com https://app.leanbe.ai https://wpdesk.net https://cloud-files.crsend.com https://staging.tellermitte.de https://static-eu.payments-amazon.com https://www.google.de https://tellermitte.de https://t.paypal.com https://www.paypalobjects.com;";

    # Frame Sources
    add_header Content-Security-Policy "frame-src 'self' https://www.youtube.com https://youtu.be https://www.youtube.de https://wp-rocket.me https://i.ytimg.com https://www.youtube-nocookie.com https://www.google.com https://www.google.de https://heidelpay.hpcgw.net https://widgets.trustedshops.com https://cloud-files.crsend.com https://rest.cleverreach.com https://www.facebook.com https://bid.g.doubleclick.net https://sibautomation.com https://in-automate.brevo.com https://fonts.gstatic.com https://*.cleverreach.com/ https://*.trustedshops.com http://*.trustedshops.com https://tellermitte.de https://js.stripe.com https://www.sandbox.paypal.com https://www.paypal.com;";

    # Font Sources
    add_header Content-Security-Policy "font-src 'self' data: https://fonts.gstatic.com https://*.cleverreach.com/ https://sibautomation.com https://*.trustedshops.com http://*.trustedshops.com https://in-automate.brevo.com https://fast.wistia.com https://widgets.trustedshops.com https://eu.cleverreach.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://www.google.com https://use.fontawesome.com https://cloud-files.crsend.com https://assets.brevo.com https://www.google.de;";

    # Object Sources
    add_header Content-Security-Policy "object-src 'self' https://www.google.com https://heidelpay.hpcgw.net https://widgets.trustedshops.com https://cloud-files.crsend.com https://www.google.de;";

    # Child Sources
    add_header Content-Security-Policy "child-src blob: https://www.youtube.com https://youtu.be https://www.youtube-nocookie.com https://sibautomation.com https://in-automate.brevo.com https://fonts.gstatic.com https://*.cleverreach.com/ https://*.trustedshops.com http://*.trustedshops.com https://widgets.trustedshops.com https://app-proxy.connect.trustedshops.com https://static-app.connect.trustedshops.com https://www.google.com https://use.fontawesome.com https://cloud-files.crsend.com https://www.google.de https://heidelpay.hpcgw.net https://tellermitte.de https://staging.tellermitte.de https://js.stripe.com https://www.sandbox.paypal.com https://www.paypal.com;";

    # Main location block
    location / {
        try_files $uri $uri/ /index.php?$args;

        if ($allowed_country = no) {
          return 403;
        }
    }

    # Deny access to .user.ini
    location ~ /\.user\.ini$ {
        deny all;
    }

    # Static files. This helps you with caching static content.
    location ~* \.(jpg|jpeg|gif|css|png|js|ico|html|svg|woff|woff2|webp)$ {
        access_log off;
        expires max;
        log_not_found off;
    }

    # favicon.ico and robots.txt
    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
    }

    # PHP files
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/run/php-fpm/www.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_intercept_errors off;
        fastcgi_buffer_size 32k;
        fastcgi_buffers 8 16k;
        fastcgi_connect_timeout 3000s;
        fastcgi_send_timeout 3000s;
        fastcgi_read_timeout 3000s;
        proxy_cookie_flags ~ secure samesite=strict;
        proxy_buffer_size               128k;
        proxy_buffers                   4 256k;
        proxy_busy_buffers_size         256k;
        fastcgi_buffering               on;
    }

    # GZIP Compression
    gzip on;
    gzip_disable "msie6";
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_min_length 256;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;
}
